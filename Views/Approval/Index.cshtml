@using System.Linq
@model Topluluk_Yonetim.MVC.Models.ViewModels.ClubApprovalDashboardViewModel
@{
    ViewData["Title"] = "Kulüp Başvurusu Onayları";
}

<div class="space-y-6">
    <div class="flex flex-col gap-4">
        <h1 class="text-2xl font-bold text-primary">Kulüp Başvurusu Onayları</h1>
        <p class="text-gray-600">Başvuru sürecindeki tüm kulüpleri buradan takip edebilir, onaylayabilir veya reddedebilirsiniz.</p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white rounded-xl shadow-sm p-4 border border-yellow-100">
                <p class="text-sm text-gray-500">Bekleyen</p>
                <p class="text-3xl font-semibold text-secondary mt-2">@Model.PendingApplications.Count()</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 border border-emerald-100">
                <p class="text-sm text-gray-500">Onaylanan</p>
                <p class="text-3xl font-semibold text-emerald-500 mt-2">@Model.ApprovedApplications.Count()</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 border border-rose-100">
                <p class="text-sm text-gray-500">Reddedilen</p>
                <p class="text-3xl font-semibold text-rose-500 mt-2">@Model.RejectedApplications.Count()</p>
            </div>
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="bg-emerald-50 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-lg">
            @TempData["SuccessMessage"]
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="bg-rose-50 border border-rose-200 text-rose-700 px-4 py-3 rounded-lg">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
        <div class="border-b border-gray-100 px-6 py-4 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
            <div>
                <p class="text-sm text-gray-500">Toplam @Model.TotalCount kayıt</p>
                <div class="flex gap-3 text-xs text-gray-500 mt-1">
                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-50 text-yellow-700">Bekleyen @Model.PendingCount</span>
                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-emerald-50 text-emerald-700">Onaylanan @Model.ApprovedCount</span>
                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-rose-50 text-rose-700">Reddedilen @Model.RejectedCount</span>
                </div>
            </div>
            <form asp-action="Index" method="get" class="grid grid-cols-1 md:grid-cols-4 gap-3 w-full md:w-auto">
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Arama</label>
                    <input name="Search" value="@Model.Filter.Search" class="w-full rounded-lg border-gray-200" placeholder="Kulüp / başvuran" />
                </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Durum</label>
                        <select name="Status" class="w-full rounded-lg border-gray-200">
                            <option value="">Tümü</option>
                            <option value="@Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Pending" selected="@(Model.Filter.Status == Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Pending)">Beklemede</option>
                            <option value="@Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Approved" selected="@(Model.Filter.Status == Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Approved)">Onaylandı</option>
                            <option value="@Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Rejected" selected="@(Model.Filter.Status == Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Rejected)">Reddedildi</option>
                        </select>
                    </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Sayfa Boyutu</label>
                    <select name="PageSize" class="w-full rounded-lg border-gray-200">
                        @foreach (var size in new[] {10,20,50})
                        {
                            <option value="@size" selected="@(Model.Filter.PageSize == size)">@size</option>
                        }
                    </select>
                </div>
                <div class="flex items-end">
                    <button type="submit" class="w-full bg-primary text-white rounded-lg px-4 py-2 font-semibold hover:bg-secondary transition">Filtrele</button>
                </div>
                <input type="hidden" name="PageNumber" value="1" />
            </form>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Kulüp</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Başvuran</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Üye Sayısı</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Danışman</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Durum</th>
                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">İşlem</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 bg-white">
                @if (Model.PagedApplications?.Items?.Any() == true)
                {
                    foreach (var application in Model.PagedApplications.Items)
                    {
                        var statusColor = application.Status switch
                        {
                            Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Approved => "bg-emerald-50 text-emerald-700",
                            Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Rejected => "bg-rose-50 text-rose-700",
                            _ => "bg-yellow-50 text-yellow-700"
                        };
                        var statusText = application.Status switch
                        {
                            Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Pending => "Beklemede",
                            Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Approved => "Onaylandı",
                            Topluluk_Yonetim.MVC.Models.Enums.ApprovalStatus.Rejected => "Reddedildi",
                            _ => application.Status.ToString()
                        };
                        var missionPreview = application.Mission.Length > 100
                            ? application.Mission.Substring(0, 100) + "..."
                            : application.Mission;
                        <tr>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold text-primary">@application.ClubName</div>
                                <div class="text-xs text-gray-500">@missionPreview</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-900">@application.ApplicantName</div>
                                <div class="text-xs text-gray-500">@application.ApplicantEmail</div>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-700">@application.EstimatedMemberCount</td>
                            <td class="px-6 py-4 text-sm text-gray-700">@(!string.IsNullOrWhiteSpace(application.AdvisorName) ? application.AdvisorName : "-")</td>
                            <td class="px-6 py-4">
                                <span class="inline-flex px-3 py-1 rounded-full text-xs font-semibold @statusColor">@statusText</span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <a asp-action="Details" asp-route-id="@application.Id" class="text-primary hover:text-secondary text-sm font-semibold">Detayı Gör</a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="px-6 py-6 text-center text-gray-500 text-sm">Kayıt bulunamadı.</td>
                    </tr>
                }
                </tbody>
            </table>
        </div>

        @if (Model.PagedApplications != null && (Model.PagedApplications.HasPrevious || Model.PagedApplications.HasNext))
        {
            <div class="flex items-center justify-between px-6 py-4 border-t border-gray-100 bg-gray-50">
                <div class="text-sm text-gray-500">Sayfa @Model.PagedApplications.PageNumber / @Model.PagedApplications.TotalPages</div>
                <div class="flex gap-2">
                    @if (Model.PagedApplications.HasPrevious)
                    {
                        <a asp-action="Index" asp-route-PageNumber="@(Model.PagedApplications.PageNumber - 1)" asp-route-PageSize="@Model.Filter.PageSize" asp-route-Search="@Model.Filter.Search" asp-route-Status="@Model.Filter.Status" class="px-3 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-100">Önceki</a>
                    }
                    @if (Model.PagedApplications.HasNext)
                    {
                        <a asp-action="Index" asp-route-PageNumber="@(Model.PagedApplications.PageNumber + 1)" asp-route-PageSize="@Model.Filter.PageSize" asp-route-Search="@Model.Filter.Search" asp-route-Status="@Model.Filter.Status" class="px-3 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-100">Sonraki</a>
                    }
                </div>
            </div>
        }
    </div>
</div>

